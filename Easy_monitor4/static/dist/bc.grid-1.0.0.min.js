/**
* bcGrid 1.0.0
* Created by BigQ on 2018-05-19
* Youth is just a section of unoptimized code!
*/
"use strict";!function(e,t){"function"==typeof define&&define.amd?define("BCGrid",[],t):"object"==typeof module&&module.exports?module.exports=e.document?t(e):t:e.BCGrid=t(e)}("undefined"!=typeof window?window:this,function(win){var BCGrid=(c=window,d=c.document,e=c.navigator&&c.navigator.userAgent||"",f=/(edge|msie|trident)/i.test(e)&&!window.opera,h=/Firefox/.test(e),j=(l=d.currentScript?d.currentScript.src:function(){for(var e,t=d.scripts,a=t.length-1,n=a;0<n;n--)if("interactive"===t[n].readyState){e=t[n].src;break}return e||t[a].src}()).substring(0,l.lastIndexOf("/")+1),{product:"BC Grid",version:"0.0.1",doc:d,isIE:/msie/i.test(e),isMoz:/gecko/.test(e),isMS:f,isWebKit:/AppleWebKit/.test(e),isFirefox:h,win:c,path:j}),l,c,d,e,f,h,j,langMaps={},s;s=BCGrid,s.addLang=function(e,t){langMaps[e]=t},s.getLangText=function(e,t){if(s.isEmptyObject(e)||"en"===e.toLowerCase()||s.isUnDefined(langMaps[e]))return t;var a=langMaps[e];return s.isDefined(a[t])?a[t]:t},s.create=function(e,t){return new BcGrid(e,t).render()},function(B){B.getID=function(){return Number(Math.random().toString().substr(3,6)+Date.now()).toString(36)},B.parseInt=function(e,t){return parseInt(e,t||10)},B.isString=function(e){return"string"==typeof e},B.isArray=function(e){var t=Object.prototype.toString.call(e);return"[object Array]"===t||"[object Array Iterator]"===t},B.isNumber=function(e){return"number"==typeof e&&!isNaN(e)},B.isObject=function(e,t){return!(!e||"object"!=typeof e||t&&B.isArray(e))},B.isJqueryObject=function(e){return e instanceof jQuery},B.isFunction=function(e){return e&&"function"==typeof e},B.isEmptyObject=function(t){return!B.isDefined(t)||""===t||null===t||!1===t||function(){var e;for(e in t)return!1;return!0}()},B.inArray=function(e,t){for(var a=e.length;a--;)if(e[a]===t)return!0;return!1},B.isDefined=function(e){return null!=e},B.isUnDefined=function(e){return!B.isDefined(e)},B.extend=function(e,t){var a;for(a in e||(e={}),t)e[a]=t[a];return e},B.getSubArray=function(e,a,n){return B.isArray(e)?e.filter(function(e,t){return void 0!==n?e[n]===a:e===a}):[]},B.arrayToTree=function(e,t,a,n){var s=[],i={},r=0;for(r=0;r<e.length;r++)i[e[r][t]]=e[r];for(r=0;r<e.length;r++){var o=e[r],l=i[o[a]];B.isDefined(l)?(B.isDefined(l[n])||(l[n]=new Array),l[n].push(o)):s.push(o)}return s},B.arrayObjectFilter=function(e,n,s){return BCGrid.isArray(e)&&0!=e.length?BCGrid.isUnDefined(n)||!BCGrid.isArray(n)&&BCGrid.isUnDefined(s)?[]:e.filter(function(e){var t=!0;if(BCGrid.isArray(n)){for(var a in n)if(e[n[a].name]!==n[a].value){t=!1;break}}else t=e[n]===s;return t}):[]},B.objectDeepCopy=function(e){var t=BCGrid.isArray(e)?[]:{};for(var a in e)t[a]=B.isObject(e[a])?BCGrid.objectDeepCopy(e[a]):e[a];return t},B.getQueryString=function(e){var t=location.search.match(new RegExp("[?&]"+e+"=([^&]+)","i"));return null==t||t.length<1?"":t[1]},B.getUrlParam=function(e,t){var a=new RegExp("[?&]"+t+"=([^&]*)").exec(e);return a&&decodeURIComponent(a[1].replace(/\+/g," "))},B.setUrlParam=function(url,name,value){var r=url;if(null!=r&&"undefined"!=r&&""!=r){value=encodeURIComponent(value);var reg=new RegExp("(^|)"+name+"=([^&]*)(|$)"),tmp=name+"="+value;r=null!=url.match(reg)?url.replace(eval(reg),tmp):url.match("[?]")?url+"&"+tmp:url+"?"+tmp}return r},B.setLoadingCenterInBrowser=function(){var e=$(".bc-loading"),t=0,a=0;window.innerWidth?(a=window.innerWidth,t=window.innerHeight):"CSS1Compat"===document.compatMode?(a=document.documentElement.clientWidth,t=document.documentElement.clientHeight):(a=document.body.clientWidth,t=document.body.clientHeight);var n=(a-e.outerWidth())/2,s=(t-e.outerHeight())/2;e.css("left",n+"px"),e.css("top",s+"px")},B.showShade=function(e,t){e=this.isNumber(e)?e:.4,t=this.isNumber(t)?t:19870515;var a=$('<div class="bc-shade"></div>');a.css("z-index",t).css("opacity",e),$("body").append(a)},B.hideShade=function(){$(".bc-shade").remove()},B.showLoading=function(e){var t={style:1,text:"Loading...",zIndex:19870515,shade:.2},a=$.extend({},t,e||{});this.showShade(a.opacity,a.zIndex-1);var n=$('<div class="bc-loading" width="180px"></div>'),s=$('<div class="bc-loading-content"></div>');3!=a.style?s.addClass("bc-loading"+a.style):(n.addClass("bc-loading-msg"),s.html('<i class="ico"></i>'+a.text)),n.css("z-index",t.zIndex),n.append(s),$("body").append(n),n.show(),$(window).on("resize",BCGrid.setLoadingCenterInBrowser),BCGrid.setLoadingCenterInBrowser()},B.hideLoading=function(){$(window).unbind("resize",this.setLoadingCenterInBrowser),$(".bc-loading").remove(),BCGrid.hideShade()},B.closeLoading=function(){BCGrid.hideLoading()},B.ajax=function(e){var n=$.extend({},{url:"",async:!0,showLoading:!0,loadingTip:"\u6570\u636e\u8bf7\u6c42\u4e2d...",loadingStyle:3,type:"post",dataType:"json",data:"",beforeSend:null,complete:null,success:null,error:null},e||{});BCGrid.isEmptyObject(n.url)&&(n.url=window.location.href),n.url=BCGrid.setUrlParam(n.url,"_tmp",(new Date).valueOf()),$.ajax({cache:!1,async:n.async,url:n.url,data:n.data,
dataType:n.dataType,type:n.type,beforeSend:function(){n.showLoading&&B.showLoading({style:n.loadingStyle,text:n.loadingTip}),n.beforeSend&&n.beforeSend()},complete:function(){n.showLoading&&B.hideLoading(),n.complete&&n.complete()},success:function(e){e&&n.success&&n.success(e)},error:function(e,t,a){n.error?n.error(e,t,a):console.log(a)}})},B.loadJS=function(e,t,a){if(B.isEmptyObject(document.getElementById(e))){var n=document.createElement("script");n.setAttribute("type","text/javascript"),n.setAttribute("src",BCGrid.path+t),n.id=e,document.getElementsByTagName("head")[0].appendChild(n),"onreadystatechange"in n?n.onreadystatechange=function(){/loaded|complete/.test(n.readyState)&&BCGrid.isFunction(a)&&a()}:n.onload=function(){BCGrid.isFunction(a)&&a()}}else BCGrid.isFunction(a)&&a()},B.loadCSS=function(e,t,a){if(B.isEmptyObject(document.getElementById(e))){var n=document.createElement("link");n.type="text/css",n.rel="stylesheet",n.href=BCGrid.path+t,n.id=e,document.getElementsByTagName("head")[0].appendChild(n),"onreadystatechange"in n?n.onreadystatechange=function(){/loaded|complete/.test(n.readyState)&&BCGrid.isFunction(a)&&a()}:n.onload=function(){BCGrid.isFunction(a)&&a()}}else BCGrid.isFunction(a)&&a()}}(BCGrid);var BcGrid=function(e,t){this.gridWrap=this.element=$(e),this.grid=null,this.gridHead=null,this.gridContent=null,this.pager=null,this.ID="",this.defaults={id:"",width:"",height:"",enabledCsrf:!1,csrfName:"_csrf",lang:"en",theme:"",csrf:"",url:"",data:{},localData:[],autoLoadData:!0,showLoading:!0,loadingTip:"Loading",loadingStyle:3,enablePager:!0,page:1,pageSize:40,pageSizeOptions:[10,20,30,40,50,100],pagerAlign:"left",pagerOption:{},sortName:"",sortOrder:"",params:[],columns:[],dataSource:"server",pageSourceType:"ajax",showCheckbox:!1,showSerialNum:!0,showBorder:!0,showStripe:!0,showHover:!0,showHead:!0,showTitle:!1,title:"",noDataText:'<div class="center">\u6682\u65e0\u4efb\u4f55\u8bb0\u5f55</div>',dateFormat:"yyyy-MM-dd hh:mm:ss",wrapCssClass:"",cssClass:"bc-table",rows:"rows",total:"total",pageParamName:"page",pageSizeParamName:"pagesize",sortNameParamName:"sortname",sortOrderParamName:"sortorder",pagerElement:null,enableSelectRow:!0,enableMultiSelectRow:!1,onCheckClick:null,onCheckAllClick:null,onError:null,onCompleted:null,onLoadData:null,onLoadedData:null,onSelectedRow:null,onRowClick:null,onTreeExpandOrCollapse:null,onDataChange:null,onDataSave:null,toolBtns:[],tree:null},this.options=$.extend({},this.defaults,t),this._rowIndex=0,this._showColumnLength=0,this._treeChildKey="",this.options.tree&&(this.options.tree=$.extend({},{displayID:"",key:"id",parentKey:"parentid",expand:!1},this.options.tree),this._treeChildKey="bc_t_"+BCGrid.getID()),this.options.url=BCGrid.isEmptyObject(this.options.url)?window.location.href:this.options.url};BcGrid.prototype={render:function(){var e=this,t=e.options;return t.lang&&"en"!==t.lang?BCGrid.loadJS("bc_grid_lang_"+t.lang,"lang/"+t.lang+".js",function(){_init.call(e)}):_init.call(e),this},loadData:function(e){var t=!1;0<arguments.length&&(t=e);var n=this,s=this.options,a=[];if(s.params){var i=BCGrid.isFunction(s.params)?s.params.call(n):s.params;if(BCGrid.isArray(i))$.each(i,function(){a.push({name:this.name,value:this.value})});else if(BCGrid.isObject(i))for(var r in i)a.push({name:r,value:i[r]})}var o=!0;if(s.onLoadData&&(o=s.onLoadData.call(n)||!0),0!=o)if("server"==s.dataSource)BCGrid.isEmptyObject(s.sortName)||(a.push({name:s.sortNameParamName,value:s.sortName}),a.push({name:s.sortOrderParamName,value:s.sortOrder})),a.push({name:s.pageParamName,value:s.page}),a.push({name:s.pageSizeParamName,value:s.pageSize}),s.enabledCsrf&&a.push({name:s.csrfName,value:s.csrf}),BCGrid.ajax({url:s.url,showLoading:s.showLoading,loadingTip:BCGrid.getLangText(s.lang,s.loadingTip),data:$.param(a),dataType:"json",success:function(e){s.data=e,_displayData.call(n),t&&s.enablePager&&_displayPage.call(n),s.onLoadedData&&s.onLoadedData.call(n,s.data)},error:function(e,t,a){s.showLoading&&BCGrid.hideLoading(),_error.call(n,"\u6570\u636e\u52a0\u8f7d\u5931\u8d25\uff01"+a.toLocaleString())},complete:function(){}});else if("local"==s.dataSource){var l=BCGrid.objectDeepCopy(n.getData());if(!BCGrid.isEmptyObject(s.sortName)&&0<l.length&&l.sort(function(e,t){return"desc"==s.sortOrder.toLowerCase()?t[s.sortName]-e[s.sortName]:e[s.sortName]-t[s.sortName]}),0<a.length&&(l=BCGrid.arrayObjectFilter(l,a)),s.enablePager){var d=BCGrid.parseInt((s.page-1)*s.pageSize);l=l.slice(d,d+BCGrid.parseInt(s.pageSize))}_displayData.call(n,l),t&&s.enablePager&&_displayPage.call(n),s.onLoadedData&&s.onLoadedData.call(n,s.data)}},reload:function(){var e=!0,t=this;t.options.onReload&&(e=t.options.onReload.call(t)),e&&(t.options.page=1,t.loadData(!0))},reloadData:function(){var e=!0;this.options.onReload&&(e=this.options.onReload.call(this)),e&&this.loadData(!0)},refresh:function(){var e=!0;this.options.onRefresh&&(e=this.options.onRefresh.call(this)),e&&_init.call(this)},getCurrentPage:function(){
return this.options.page},get:function(e){return this.options[e]},set:function(e){this.options=$.extend(this.options,e)},getData:function(){return BCGrid.isDefined(this.options.data[this.options.rows])?this.options.data[this.options.rows]:[]},getRowData:function(e){return this.options.data[this.options.rows][e]},getTotal:function(){return this.options.data[this.options.total]||0},deleteRow:function(e){var t=this.options;$('tr[id="bcgrid_'+this.ID+"_list_"+e+'"]',this.gridContent).remove(),t.data[t.total]=parseInt(t.data[t.total])-1,_displayPage.call(this)},deleteRows:function(e){var t=this,a=this.options;$.each(e,function(){$('tr[id="bcgrid_'+t.ID+"_list_"+this+'"]',t.gridContent).remove()}),a.data[a.total]=parseInt(a.data[a.total])-e.length,_displayPage.call(t)},getCheckedRows:function(){var e=[],t=this.options;return t.showCheckbox&&$('input[tag="bcgrid_checkbox"]',this.gridContent).each(function(){$(this).is(":checked")&&e.push(t.data[t.rows][parseInt($(this).closest("tr").data("rowindex"))])}),e},setCheckedRows:function(e,a){var n=this;this.options;$.each(e,function(e,t){n.setCheckedRow(t,a)})},setCheckedRow:function(e,t){this.options;$("#bcgrid_"+this.ID+"_checkbox_list_"+e,this.gridContent).prop("checked",t)},getCheckedRowsIndex:function(){var e=[];return this.options.showCheckbox&&$('input[tag="bcgrid_checkbox"]',this.gridContent).each(function(){$(this).is(":checked")&&e.push(parseInt($(this).closest("tr").data("rowindex")))}),e},updateRow:function(e,a){var n=this,t=this.options,s=[];a?t.data[t.rows][e]=a:a=t.data[t.rows][e],s.push(n._preRenderColumn(e)),$.each(t.columns,function(e,t){s.push(n._renderColumnData(t,a,e))}),$("#bcgrid_"+n.ID+"_list_"+e).html(s.join("")),_bindEvent.call(n)},updateColumn:function(a,n){var s=this,i=this.options;n?i.columns[a]=n:n=i.columns[a],$('td[data-role="data"][data-columnindex="'+a+'"]',s.gridContent).each(function(){var e=$(this),t=e.parent("tr").data("rowindex");e.replaceWith(s._renderColumnData(n,i.data[i.rows][t],a,t))})},setTitle:function(e){this.options.title=e,$("#bcgrid_"+this.ID+"_title").html(e)},addColumn:function(e,t){var a=this.options,n=t||a.columns.length-1;a.columns.splice(n,0,e||{}),this.refresh()},setData:function(e){var t=this.options;t.data[t.rows]=e,t.data[t.total]=e.length}};var _init=function(){var e=this,t=this.options;BCGrid.isEmptyObject(t.data)&&!BCGrid.isEmptyObject(t.localData)&&(t.data[t.rows]=t.localData,t.data[t.total]=t.localData.length),BCGrid.isEmptyObject(t.id)||(e.ID=t.id),BCGrid.isEmptyObject(e.ID)&&(e.ID="bc_"+BCGrid.getID()),t.enabledCsrf&&BCGrid.isEmptyObject(t.csrf)&&(t.csrf=$("input[name='"+t.csrfName+"']").val()),e.gridWrap.hasClass(t.wrapCssClass)||e.gridWrap.addClass(t.wrapCssClass);var a=BCGrid.getQueryString(t.pageParamName);isNaN(a)||""==a||(t.page=a);var n=$(".bc-table-wrap",e.gridWrap);0==n.length&&(n=$('<div class="bc-table-wrap"></div>')),e.grid=$('<table role="grid"></table>'),e.grid.attr("id",e.ID),e.grid.addClass(t.cssClass),t.showBorder&&e.grid.addClass("table-bordered"),t.showStripe&&e.grid.addClass("table-striped"),t.showHover&&e.grid.addClass("table-hover"),BCGrid.isEmptyObject(t.width)||n.css("width",t.width),BCGrid.isEmptyObject(t.height)||n.css("height",t.height),_preRenderColumnOpt.call(e),(t.showHead||t.showTitle)&&_setHead.call(e),_setGridContent.call(e),0==$("#"+e.ID,n).length?n.html(e.grid):($("#"+e.ID,n).remove(),n.prepend(e.grid)),e.gridWrap.html(n),t.onCompleted&&t.onCompleted.call(e),t.autoLoadData&&e.loadData(!0)},_preRenderColumnOpt=function(){var e=this.options,t={display:"",id:"",name:"name",type:"text",render:null,hide:!1,align:null,maxLength:null,format:null,role:"data",enableSort:!1,enableEdit:!1,editType:"textField",action:null,saveUrl:""};this._showColumnLength=e.columns.length;for(var a=0;a<e.columns.length;a++)e.columns[a]=$.extend({},t,e.columns[a]||{}),e.columns[a].hide&&this._showColumnLength--;e.showCheckbox&&this._showColumnLength++,e.showSerialNum&&this._showColumnLength++},_setHead=function(){var e=this,t=this.options,a=[];a.push("<thead>"),t.showTitle&&(a.push('<tr role="row" class="head-title">'),a.push('<th class="center" colspan="'+e._showColumnLength+'" id="bcgrid_'+e.ID+'_title">'+t.title+"</th>"),a.push("</tr>")),t.showHead&&(a.push('<tr role="row">'),t.showCheckbox&&a.push('<th class="center"> <label><input type="checkbox" id="bcgrid_'+e.ID+'_checkbox_all" tag="bcgrid_checkbox"/><span class="lbl"></span></label></th>'),t.showSerialNum&&a.push('<th class="center">'+BCGrid.getLangText(t.lang,"Serial")+"</th>"),a.push(_getHeadColumn.call(e)),a.push("</tr>")),a.push("</thead>"),e.gridHead=$(a.join("")),e.grid.html(e.gridHead)},_getHeadColumn=function(){var i=this,e=this.options,r=[];return $.each(e.columns,function(e,t){var a=t.display;BCGrid.isFunction(a)&&(a=a.call(i,t,e),BCGrid.isUnDefined(a)&&(a=""));var n=$('<th data-col="'+t.name+'" data-columnindex="'+e+'"></th>');if(BCGrid.isEmptyObject(t.width)||(isNaN(t.width)?n.attr("width",t.width):n.addClass("width-"+t.width)),
t.hide&&n.hide(),n.html(a),t.enableSort){!n.hasClass("cursor-pointer")&&n.addClass("cursor-pointer");var s=$('<span class="sort"><i class="asc"></i><i class="desc"></i></span>');n.append(s)}r.push(n.prop("outerHTML"))}),r.join("")},_setGridContent=function(){this.gridContent=$("<tbody></tbody>"),this.grid.append(this.gridContent)},_displayData=function(e){var t=this,a=t.options;e=e||t.getData(),t.gridContent.empty(),t._rowIndex=0;var n=a.tree?BCGrid.arrayToTree(BCGrid.objectDeepCopy(e),a.tree.key,a.tree.parentKey,t._treeChildKey):e;t.gridContent.html(_displayListData.call(t,n,0)),0==n.length?$('input:checkbox[tag="bcgrid_checkbox"]',t.gridHead).attr("disabled","disabled"):$('input:checkbox[tag="bcgrid_checkbox"]',t.gridHead).removeAttr("disabled"),_bindEvent.call(t)},_displayListData=function(e,i,r){var o=this,l=this.options,d=[];return BCGrid.isUnDefined(i)&&(i=0),BCGrid.isUnDefined(r)&&(r=0),r--,0==e.length&&0==i?(d.push('<tr id="bcgrid_'+o.ID+'_list_nodata" role="row" class="no_data">'),d.push('<td colspan="'+o._showColumnLength+'" class="text-center">'+l.noDataHtml+"</td>"),d.push("</tr>")):$.each(e,function(e,a){var n=!1,t=[],s="";l.tree&&(0<(t=BCGrid.isDefined(a[o._treeChildKey])?a[o._treeChildKey]:[]).length&&(n=!0),0<i&&(s+='data-parentrowindex="'+r+'"',l.tree.expand||(s+=' style="display:none;"'))),d.push('<tr id="bcgrid_'+o.ID+"_list_"+o._rowIndex+'" role="row" data-rowindex="'+o._rowIndex+'"'+s+">"),d.push(_preRenderColumn.call(o)),$.each(l.columns,function(e,t){d.push(_renderColumnData.call(o,t,a,e,o._rowIndex,i,n))}),d.push("</tr>"),o._rowIndex++,l.tree&&n?d.push(_displayListData.call(o,t,i+1,o._rowIndex)):i=0}),d.join("")},_preRenderColumn=function(){var e=this.options,t=[];if(e.showCheckbox){t.push('<td class="center" data-role="checkbox"> <label class="pos-rel"><input type="checkbox" id="bcgrid_'+this.ID+"_checkbox_list_"+this._rowIndex+'" tag="bcgrid_checkbox" /><span class="lbl"></span></label></td>')}if(e.showSerialNum){var a=0;a="all"==(e.pageSize+"").toLowerCase()?this._rowIndex+1:this._rowIndex+1+(e.page-1)*e.pageSize,t.push('<td class="center" data-role="data">'+a+"</td>")}return t.join("")},_displayPage=function(){var a=this,n=this.options;if(!BCGrid.isEmptyObject(n.data)&&n.enablePager){var e={pageSize:n.pageSize,recordCount:n.data[n.total],pageSizeOptions:n.pageSizeOptions,currentPage:n.page,lang:n.lang,turnPageEvent:function(e,t){n.page=e,n.pageSize=t,a.loadData(!1,e)}};e=$.extend(!0,n.pagerOption||{},e),BCGrid.isEmptyObject(n.pagerElement)&&(n.pagerElement=$("<div></div>"),n.pagerElement.insertAfter(a.grid)),1<n.pagerElement.length&&(e.turnPageEvent=function(e,t){n.page=e,n.pageSize=t,a.loadData(!0,e)}),n.pagerElement.each(function(){a.pager=new Pager($(this),e),a.pager.render()})}},_renderColumnData=function(column,data,colIndex,rowIndex,treeDepth,hasChild){var g=this,p=this.options,opt=column,dataRes="";if(treeDepth=BCGrid.isDefined(treeDepth)?treeDepth:0,hasChild=!!BCGrid.isDefined(hasChild)&&hasChild,BCGrid.isString(opt.render)&&eval("opt.render="+opt.render),BCGrid.isFunction(opt.render))dataRes=opt.render.call(g,data,g._rowIndex),BCGrid.isObject(dataRes)&&(dataRes=BCGrid.isJqueryObject(dataRes)?dataRes[0].outerHTML:dataRes.outerHTML),BCGrid.isDefined(dataRes)||(dataRes="");else switch(opt.type){case"dateTime":case"date":dataRes=_formatDate.call(g,data[column.name],opt.format);break;case"checkbox":dataRes=_checkboxItem.call(g,rowIndex+0,column,data,colIndex);break;case"textField":dataRes=_inputItem.call(g,rowIndex+0,column,data,colIndex);break;case"select":dataRes=_selectItem.call(g,rowIndex+0,column,data,colIndex);break;default:var val=BCGrid.isDefined(data[column.name])?data[column.name]+"":"";opt.maxLength&&BCGrid.isNumber(opt.maxLength)&&val.length>opt.maxLength&&(val=val.substr(0,opt.maxLength)+"..."),dataRes=_formatText.call(this,val,opt.format)}if(dataRes+="",p.tree&&p.tree.displayID===column.id&&(hasChild&&(dataRes=' <span class="tree-expander '+(p.tree.expand?"tree-expander-expanded":"tree-expander-collapsed")+'"></span>'+dataRes),0<treeDepth)){for(var treeSpace="",i=0;i<treeDepth;i++)treeSpace+='<span class="tree-indent"></span>';hasChild||(treeSpace+='<span class="tree-indent"></span>'),dataRes=treeSpace+dataRes}opt.enableEdit&&(dataRes='<span data-role="display">'+dataRes+"</span>"),dataRes='<td data-role="'+opt.role+'" data-columnindex="'+colIndex+'">'+dataRes+"</td>";var $ret=$(dataRes);return opt.align&&$ret.addClass(opt.align),"table"==opt.type&&$ret.addClass("none-padding"),opt.hide&&$ret.hide(),$ret.prop("outerHTML")},_checkboxItem=function(e,t,a,n){t.elValue=void 0!==t.elValue?t.elValue:1;var s=$("<label></label>"),i=$('<input class="columnCheckBox"   type="checkbox" data-rowindex="'+e+'" data-colindex="'+n+'" >');return t.elName?i.attr("name",t.elName):i.attr("name",t.name),i.attr("value",t.elValue),t.name&&a[t.name]==t.elValue&&i.attr("checked","checked"),s.append(i),s.append('<span class="lbl"></span>'),s.prop("outerHTML")},_selectItem=function(e,a,n,t
){a.items=a.items||[];var s=$('<select class="columnSelect" data-rowindex="'+e+'" data-colindex="'+t+'" ></select>');return a.elName?s.attr("name",a.elName):s.attr("name",a.name),a.itemsName&&(a.items=n[a.itemsName]),$.each(a.items,function(e,t){a.name&&(void 0!==n[a.name]?n[a.name]:"")==t.value?s.append('<option value="'+t.value+'" selected="selected">'+t.text+"</option>"):s.append('<option value="'+t.value+'">'+t.text+"</option>")}),s.prop("outerHTML")},_inputItem=function(e,t,a,n){var s=$('<input class="width_90 columnEdit" data-rowindex="'+e+'" data-colindex="'+n+'" />');return t.elName?s.attr("name",t.elName):s.attr("name",t.name),s.attr("value",void 0!==a[t.name]?a[t.name]:""),s.prop("outerHTML")},_formatText=function(e,t){return void 0===e&&(e=""),t?(e+="",t.replace(/\{value\}/g,e)):e},_formatDate=function(value,format){var g=this,p=g.options;function getFormat(e,t){if(isNaN(e))return"";var a=t,n={"M+":e.getMonth()+1,"d+":e.getDate(),"h+":e.getHours(),"m+":e.getMinutes(),"s+":e.getSeconds(),"q+":Math.floor((e.getMonth()+3)/3),"S+":e.getMilliseconds()};for(var s in/(y+)/.test(a)&&(a=a.replace(RegExp.$1,(e.getFullYear()+"").substr(4-RegExp.$1.length))),n)new RegExp("("+s+")").test(a)&&(a=a.replace(RegExp.$1,1==RegExp.$1.length?n[s]:("00"+n[s]).substr((""+n[s]).length)));return a}if(!value)return"";if("string"==typeof value&&/^\/Date/.test(value)&&(value=value.replace(/^\//,"new ").replace(/\/$/,""),eval("value = "+value)),!isNaN(value)){var newDate=new Date;newDate.setTime(1e3*value),value=newDate}if(value instanceof Date){var formatOpt=format||p.dateFormat;return getFormat(value,formatOpt)}return value.toString()},_initToolBtn=function(){var t=this,e=this.options,a=[];e.refreshBtnEnable&&a.push({id:"refresh_"+t.ID,title:"\u5237\u65b0",style:"btn-primary",icon:"glyphicon-refresh",click:function(e){t.reload()}}),a.push.apply(a,e.toolBtns),t.pager.addToolButton(a)},_bindEvent=function(){var i=this,r=this.options,s=r.data[r.rows];$('input[type="checkbox"][tag="bcgrid_checkbox"]',i.gridHead).unbind(),$('input[type="checkbox"][tag="bcgrid_checkbox"]',i.gridHead).on("click",function(e){var t=!1;$(this).is(":checked")?(t=!0,$(":checkbox[tag='bcgrid_checkbox']",i.gridContent).prop("checked",!0)):(t=!1,$(":checkbox[tag='bcgrid_checkbox']",i.gridContent).prop("checked",!1)),r.onCheckAllClick&&BCGrid.isFunction(r.onCheckAllClick)&&r.onCheckAllClick.call(i,t)}),$("th[data-col]",i.gridHead).unbind(),$("th[data-col]",i.gridHead).on("click",function(){var e=$(this),t=parseInt(e.data("columnindex"));if(r.columns[t].enableSort){var a=$("span.sort",e),n=e.data("col")||"",s=a.attr("order")||"asc";BCGrid.isDefined(n)&&($("span.sort",i.gridHead).removeAttr("order"),"asc"==s?a.attr("order","desc"):a.attr("order","asc"),r.sortName=n,r.sortOrder=s,i.loadData())}}),$('input[type="checkbox"][tag="bcgrid_checkbox"]',i.gridContent).unbind(),$('input[type="checkbox"][tag="bcgrid_checkbox"]',i.gridContent).on("click",function(e){var t=!1,a=$(this),n=a.closest("tr");a.is(":checked")?(t=!0,n.addClass("active")):n.removeClass("active");var s=parseInt(n.data("rowindex"));r.onCheckClick&&BCGrid.isFunction(r.onCheckClick)&&r.onCheckClick.call(i,s,t,r.data[r.rows][s]),e.stopPropagation()}),$('tr[role="row"]:not(.no_data)',i.gridContent).unbind(),$('tr[role="row"]:not(.no_data)',i.gridContent).on("click",function(e){if(!_isEditTarget(e.target)){var t=$(this),a=parseInt(t.data("rowindex"));if(r.enableSelectRow){var n=!1;t.hasClass("selected")?(n=!1,t.removeClass("selected")):(n=!0,t.addClass("selected"),0==r.enableMultiSelectRow&&t.siblings().removeClass("selected")),r.onSelectedRow&&n&&BCGrid.isFunction(r.onSelectedRow)&&r.onSelectedRow.call(i,a,s[a])}r.onRowClick&&BCGrid.isFunction(r.onRowClick)&&r.onRowClick.call(i,a,s[a])}}),$("span.tree-expander",i.gridContent).unbind(),r.tree&&$("span.tree-expander",i.gridContent).on("click",function(){var e=$(this).closest("tr"),t=e.data("rowindex"),a=_toggleTree.call(i,e);r.onTreeExpandOrCollapse&&BCGrid.isFunction(r.onTreeExpandOrCollapse)&&r.onTreeExpandOrCollapse.call(i,a,t)}),_bindChangeEvent.call(i)},_bindChangeEvent=function(){var i=this,r=this.options;$("input.edit[data-rowindex],select.select[data-rowindex]",i.gridContent).unbind(),$("input.edit[data-rowindex],select.select[data-rowindex]",i.gridContent).on("change",function(){var e=$(this),t=e.attr("name"),a=parseInt(e.data("rowindex")),n=parseInt(e.data("colindex")),s=e.val();r.data[r.rows][a][t]=s,r.onDataChange&&BCGrid.isFunction(r.onDataChange)&&r.onDataChange.call(i,r.data[r.rows][a],t,s,a,n)}),$('input[type="checkbox"][data-rowindex]',i.gridContent).unbind(),$('input[type="checkbox"][data-rowindex]',i.gridContent).on("click",function(){var e=$(this),t=e.attr("name"),a=parseInt(e.data("rowindex")),n=parseInt(e.data("colindex")),s="";e.is("checked")&&(s=e.val()),r.data[r.rows][a][t]=s,r.onDataChange&&BCGrid.isFunction(r.onDataChange)&&r.onDataChange.call(i,r.data[r.rows][a],t,s,a,n)})},_toggleTree=function(e){this.options;var t=!1,a=$(
".tree-expander",e);return a.hasClass("tree-expander-collapsed")?(a.removeClass("tree-expander-collapsed").addClass("tree-expander-expanded"),t=!0):(a.removeClass("tree-expander-expanded").addClass("tree-expander-collapsed"),t=!1),_toggleTreeChild.call(this,e,t),t},_toggleTreeChild=function(e,n){var s=this,t=(s.options,e.data("rowindex"));e.nextAll('tr[data-parentrowindex="'+t+'"]').each(function(){var e=$(this),t=$(".tree-expander",e),a=t.hasClass("tree-expander");n?e.show():e.hide(),a&&(n?t.hasClass("tree-expander-collapsed")?_toggleTreeChild.call(s,e,!1):_toggleTreeChild.call(s,e,!0):_toggleTreeChild.call(s,e,!1))})},_error=function(e){if(!this.options.onError)throw e;this.options.onError.call(this,e)},_isEditTarget=function(e){if(!BCGrid.isDefined(e))return!1;var t=$(e);return!!t.is("span.tree-expander")||(!!t.is("span.lbl")||(!!t.is("input")||(!!t.is("select")||(!!t.is("textarea")||!!t.is("a")))))},Pager=function(e,t){this.pageWrap=this.element=$(e),this.pageCount=0,this.toolButtons=[],this.defaults={pageSize:40,recordCount:0,lang:"en",showFirst:!0,showLast:!0,showPrev:!0,showNext:!0,showWhenever:!0,showPageSizeOpt:!0,currentPage:1,pageSizeOptions:[10,20,30,40,50],firstText:"First",lastText:"Last",prevText:"Previous",nextText:"Next",turnPageEvent:null,ellipseText:"...",disabledCssClass:"disabled",ellipseCssClass:"ellipsis",firstCssClass:"first-page",lastCssClass:"last-page",prevCssClass:"prev-page",nextCssClass:"next-page",itemCssClass:"",itemCurrCssClass:"current",toolCssClass:"page-tool",infoCssClass:"page-info",linkCssClass:"page-link",optCssClass:"page-size",wrapCssClass:"bc-page",pageInfoTpl:"Page {currentPage} of {pageCount},{pageSize} records per page,total {recordCount} records",buttons:[]},this.options=$.extend({},!0,this.defaults,t)};return Pager.prototype={render:function(){return this._init(),this},_init:function(){var e=this.options;this.pageWrap.hasClass(e.wrapCssClass)||this.pageWrap.addClass(e.wrapCssClass),isNaN(e.pageSize)?this.pageCount=1:this.pageCount=Math.ceil(e.recordCount/e.pageSize),0==this.pageCount&&(this.pageCount=1),this._builder()},_builder:function(){var e=this.options;this.pageInfoWrap=$("<span> </span>"),this.pageOptWrap=$("<span> </span>"),this.pageToolWrap=$("<span></span>"),this.pageLinkWrap=$("<span></span>"),this.pageWrap.empty(),this.pageInfoWrap.addClass(e.infoCssClass),this.pageOptWrap.addClass(e.optCssClass),this.pageLinkWrap.addClass(e.linkCssClass),this.pageWrap.append(this.pageInfoWrap),this.pageWrap.append(this.pageLinkWrap),e.showPageSizeOpt&&(this.pageWrap.append(this.pageOptWrap),this._getPageOpt()),this._getPageInfo(),this._getPageContent(),this._bindEvent(),this._getPageTools()},_getPageInfo:function(){var e=this.options,t=e.pageInfoTpl.replace(/\{currentPage\}/g,e.currentPage);t=(t=(t=t.replace(/\{pageCount\}/g,this.pageCount)).replace(/\{recordCount\}/g,e.recordCount)).replace(/\{pageSize\}/g,e.pageSize),this.pageInfoWrap.html(t)},_getPageContent:function(){var e="",t=this,a=this.options;if(a.showFirst&&(e+='<a href="javascript:;" class="'+a.firstCssClass+'" >'+a.firstText+"</a>"),a.showPrev&&(e+='<a href="javascript:;" class="'+a.prevCssClass+'">'+a.prevText+"</a>"),6<t.pageCount){if(e+='<a href="javascript:;" data-page="1" >1</a>',a.currentPage<=2)e+='<a href="javascript:;" data-page="2">2</a>',e+='<a href="javascript:;" data-page="3">3</a></li>',e+='<span class="'+a.ellipseCssClass+'">'+a.ellipseText+"</span>";else if(2<a.currentPage&&a.currentPage<=t.pageCount-2)e+='<span class="'+a.ellipseCssClass+'">'+a.ellipseText+"</span>",e+='<a  href="javascript:;" data-page="'+(a.currentPage-1)+'">'+(a.currentPage-1)+"</a>",e+='<a  href="javascript:;" data-page="'+a.currentPage+'">'+a.currentPage+"</a>",e+='<a  href="javascript:;" data-page="'+(a.currentPage+1)+'">'+(a.currentPage+1)+"</a>",e+='<span class="'+a.ellipseCssClass+'">'+a.ellipseText+"</span>";else{e+='<span class="'+a.ellipseCssClass+'">'+a.ellipseText+"</span>";for(var n=t.pageCount-2;n<t.pageCount;n++)e+='<a  href="javascript:;" data-page="'+n+'">'+n+"</a>"}e+='<a href="javascript:void(0);" data-page="'+t.pageCount+'">'+t.pageCount+"</a>  "}else for(n=1;n<=t.pageCount;n++)e+='<a href="javascript:;" data-page="'+n+'">'+n+"</a>";a.showNext&&(e+='<a href="javascript:;" class="'+a.nextCssClass+'" >'+a.nextText+"</a>"),a.showLast&&(e+='<a href="javascript:;" class="'+a.lastCssClass+'" >'+a.lastText+"</a>"),this.pageLinkWrap.html(e),1==a.currentPage&&($("."+a.firstCssClass,t.pageLinkWrap).addClass(a.disabledCssClass),$("."+a.prevCssClass,t.pageLinkWrap).addClass(a.disabledCssClass)),a.currentPage==t.pageCount&&($("."+a.lastCssClass,t.pageLinkWrap).addClass(a.disabledCssClass),$("."+a.nextCssClass,t.pageLinkWrap).addClass(a.disabledCssClass)),this.pageLinkWrap.find('a[data-page="'+a.currentPage+'"]').addClass(a.itemCurrCssClass).siblings().removeClass(a.itemCurrCssClass)},_getPageOpt:function(){var e=this,t=this.options,a=$("<select></select>"),n="";if(0<t.pageSizeOptions.length){for(
var s=0;s<t.pageSizeOptions.length;s++)BCGrid.isNumber(t.pageSizeOptions[s])?n+='<option value="'+t.pageSizeOptions[s]+'">'+t.pageSizeOptions[s]+"</option>":"all"==(t.pageSizeOptions[s]+"").toLowerCase()&&(n+='<option value="all">All</option>');a.html(n),a.val(t.pageSize),this.pageOptWrap.html(""),this.pageOptWrap.append(BCGrid.getLangText(t.lang,"Per page")),this.pageOptWrap.append(a),this.pageOptWrap.append(BCGrid.getLangText(t.lang,"Records")),$("select",this.pageOptWrap).on("change",function(){t.pageSize=$(this).val(),t.currentPage=1,e.render(),e.goPage()})}},_getPageTools:function(){var a=this,e=this.options;a.toolButtons=[],$.each(e.buttons,function(e,t){a._addToolsButtonItem(t)})},_addToolsButtonItem:function(e){},_bindEvent:function(){var t=this,a=this.options;t.pageLinkWrap.on("click","a",function(e){if($(this).hasClass(a.disabledCssClass)||$(this).hasClass(a.itemCurrCssClass))return!1;$(this).hasClass(a.firstCssClass)?a.currentPage=1:$(this).hasClass(a.prevCssClass)?a.currentPage=Math.max(1,a.currentPage-1):$(this).hasClass(a.nextCssClass)?a.currentPage=Math.min(t.pageCount,a.currentPage+1):$(this).hasClass(a.lastCssClass)?a.currentPage=t.pageCount:$(this).data("page")&&(a.currentPage=parseInt($(this).data("page"))),t.goPage()})},goPage:function(e){var t=this,a=this.options;a.currentPage=e||a.currentPage,a.currentPage=Math.max(1,a.currentPage),a.currentPage=Math.min(a.currentPage,t.pageCount),t._getPageInfo(),t._getPageContent(),a.showPageSizeOpt&&t._getPageOpt(),BCGrid.isFunction(a.turnPageEvent)&&a.turnPageEvent.call(t,a.currentPage,a.pageSize)},addToolButton:function(e){}},BCGrid});